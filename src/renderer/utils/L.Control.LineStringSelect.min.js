!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;(e=(e=(e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).L||(e.L={})).Control||(e.Control={})).LineStringSelect=t()}}(function(){return function o(s,a,h){function l(e,t){if(!a[e]){if(!s[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(c)return c(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var r=a[e]={exports:{}};s[e][0].call(r.exports,function(t){return l(s[e][1][t]||t)},r,r.exports,o,s,a,h)}return a[e].exports}for(var c="function"==typeof require&&require,t=0;t<h.length;t++)l(h[t]);return l}({1:[function(i,n,t){(function(t){
/**
 * Leaflet LineString selection control
 * @license MIT
 * @author Alexander Milevski <info@w8r.name>
 * @preserve
 */
var e="undefined"!=typeof window?window.L:void 0!==t?t.L:null;e.Control.LineStringSelect=n.exports=i("./src/select"),e.control.lineStringSelect=function(t){return new e.Control.LineStringSelect(t)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./src/select":6}],2:[function(t,e,i){var n,r;n=this,r=function(){"use strict";function _(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function l(t,e){return t<e?-1:e<t?1:0}function t(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}function c(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function f(t,e){m(t,0,t.children.length,e,t)}function m(t,e,i,n,r){(r=r||g(null)).minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var o=e;o<i;o++){var s=t.children[o];d(r,t.leaf?n(s):s)}return r}function d(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function o(t,e){return t.minX-e.minX}function s(t,e){return t.minY-e.minY}function v(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function p(t){return t.maxX-t.minX+(t.maxY-t.minY)}function u(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function h(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function g(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function M(t,e,i,n,r){for(var o=[e,i];o.length;)if(!((i=o.pop())-(e=o.pop())<=n)){var s=e+Math.ceil((i-e)/n/2)*n;h=r,function t(e,i,n,r,o){for(;n<r;){if(600<r-n){var s=r-n+1,a=i-n+1,h=Math.log(s),l=.5*Math.exp(2*h/3),c=.5*Math.sqrt(h*l*(s-l)/s)*(a-s/2<0?-1:1);t(e,i,Math.max(n,Math.floor(i-a*l/s+c)),Math.min(r,Math.floor(i+(s-a)*l/s+c)),o)}var u=e[i],d=n,f=r;for(_(e,n,i),0<o(e[r],u)&&_(e,n,r);d<f;){for(_(e,d,f),d++,f--;o(e[d],u)<0;)d++;for(;0<o(e[f],u);)f--}0===o(e[n],u)?_(e,n,f):_(e,++f,r),f<=i&&(n=f+1),i<=f&&(r=f-1)}}(a=t,s,e||0,i||a.length-1,h||l),o.push(e,s,s,i)}var a,h}return t.prototype.all=function(){return this._all(this.data,[])},t.prototype.search=function(t){var e=this.data,i=[];if(!h(t,e))return i;for(var n=this.toBBox,r=[];e;){for(var o=0;o<e.children.length;o++){var s=e.children[o],a=e.leaf?n(s):s;h(t,a)&&(e.leaf?i.push(s):u(t,a)?this._all(s,i):r.push(s))}e=r.pop()}return i},t.prototype.collides=function(t){var e=this.data;if(!h(t,e))return!1;for(var i=[];e;){for(var n=0;n<e.children.length;n++){var r=e.children[n],o=e.leaf?this.toBBox(r):r;if(h(t,o)){if(e.leaf||u(t,o))return!0;i.push(r)}}e=i.pop()}return!1},t.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},t.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},t.prototype.clear=function(){return this.data=g([]),this},t.prototype.remove=function(t,e){if(!t)return this;for(var i,n,r,o=this.data,s=this.toBBox(t),a=[],h=[];o||a.length;){if(o||(o=a.pop(),n=a[a.length-1],i=h.pop(),r=!0),o.leaf){var l=c(t,o.children,e);if(-1!==l)return o.children.splice(l,1),a.push(o),this._condense(a),this}r||o.leaf||!u(o,s)?n?(i++,o=n.children[i],r=!1):o=null:(a.push(o),h.push(i),i=0,o=(n=o).children[0])}return this},t.prototype.toBBox=function(t){return t},t.prototype.compareMinX=function(t,e){return t.minX-e.minX},t.prototype.compareMinY=function(t,e){return t.minY-e.minY},t.prototype.toJSON=function(){return this.data},t.prototype.fromJSON=function(t){return this.data=t,this},t.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},t.prototype._build=function(t,e,i,n){var r,o=i-e+1,s=this._maxEntries;if(o<=s)return f(r=g(t.slice(e,i+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,n-1))),(r=g([])).leaf=!1,r.height=n;var a=Math.ceil(o/s),h=a*Math.ceil(Math.sqrt(s));M(t,e,i,h,this.compareMinX);for(var l=e;l<=i;l+=h){var c=Math.min(l+h-1,i);M(t,l,c,a,this.compareMinY);for(var u=l;u<=c;u+=a){var d=Math.min(u+a-1,c);r.children.push(this._build(t,u,d,n-1))}}return f(r,this.toBBox),r},t.prototype._chooseSubtree=function(t,e,i,n){for(;n.push(e),!e.leaf&&n.length-1!==i;){for(var r=1/0,o=1/0,s=void 0,a=0;a<e.children.length;a++){var h=e.children[a],l=v(h),c=(u=t,d=h,(Math.max(d.maxX,u.maxX)-Math.min(d.minX,u.minX))*(Math.max(d.maxY,u.maxY)-Math.min(d.minY,u.minY))-l);c<o?(o=c,r=l<r?l:r,s=h):c===o&&l<r&&(r=l,s=h)}e=s||e.children[0]}var u,d;return e},t.prototype._insert=function(t,e,i){var n=i?t:this.toBBox(t),r=[],o=this._chooseSubtree(n,this.data,e,r);for(o.children.push(t),d(o,n);0<=e&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(n,r,e)},t.prototype._split=function(t,e){var i=t[e],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var o=this._chooseSplitIndex(i,r,n),s=g(i.children.splice(o,i.children.length-o));s.height=i.height,s.leaf=i.leaf,f(i,this.toBBox),f(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(i,s)},t.prototype._splitRoot=function(t,e){this.data=g([t,e]),this.data.height=t.height+1,this.data.leaf=!1,f(this.data,this.toBBox)},t.prototype._chooseSplitIndex=function(t,e,i){for(var n,r,o,s,a,h,l,c=1/0,u=1/0,d=e;d<=i-e;d++){var f=m(t,0,d,this.toBBox),_=m(t,d,i,this.toBBox),p=(r=f,o=_,void 0,s=Math.max(r.minX,o.minX),a=Math.max(r.minY,o.minY),h=Math.min(r.maxX,o.maxX),l=Math.min(r.maxY,o.maxY),Math.max(0,h-s)*Math.max(0,l-a)),g=v(f)+v(_);p<c?(c=p,n=d,u=g<u?g:u):p===c&&g<u&&(u=g,n=d)}return n||i-e},t.prototype._chooseSplitAxis=function(t,e,i){var n=t.leaf?this.compareMinX:o,r=t.leaf?this.compareMinY:s;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,r)&&t.children.sort(n)},t.prototype._allDistMargin=function(t,e,i,n){t.children.sort(n);for(var r=this.toBBox,o=m(t,0,e,r),s=m(t,i-e,i,r),a=p(o)+p(s),h=e;h<i-e;h++){var l=t.children[h];d(o,t.leaf?r(l):l),a+=p(o)}for(var c=i-e-1;e<=c;c--){var u=t.children[c];d(s,t.leaf?r(u):u),a+=p(s)}return a},t.prototype._adjustParentBBoxes=function(t,e,i){for(var n=i;0<=n;n--)d(e[n],t)},t.prototype._condense=function(t){for(var e=t.length-1,i=void 0;0<=e;e--)0===t[e].children.length?0<e?(i=t[e-1].children).splice(i.indexOf(t[e]),1):this.clear():f(t[e],this.toBBox)},t},"object"==typeof i&&void 0!==e?e.exports=r():(n=n||self).RBush=r()},{}],3:[function(t,e,i){var n=t("./marker"),r=n.extend({options:{radiusRatio:1.2},onAdd:function(t){this.on("mouseover",this._onMouseOver,this).on("mouseout",this._onMouseOut,this),n.prototype.onAdd.call(this,t)},onRemove:function(t){this.off("mouseover",this._onMouseOver,this).off("mouseout",this._onMouseOut,this),n.prototype.onRemove.call(this,t)},_onMouseOver:function(){this.setRadius(this.options.radius*this.options.radiusRatio)},_onMouseOut:function(){this.setRadius(this.options.radius/this.options.radiusRatio)}});e.exports=r},{"./marker":5}],4:[function(t,e,i){function a(t,e){var i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n}function o(t,e,i){return t+i*(e-t)}e.exports={pointSegmentDistance:function(t,e,i){var n=i[0]-e[0],r=i[1]-e[1],o=n*n+r*r,s=o&&((t[0]-e[0])*n+(t[1]-e[1])*(i[1]-e[1]))/o;return a(t,s<=0?e:1<=s?i:[e[0]+s*n,e[1]+s*r])},closestPointOnSegment:function(t,e,i){var n=function(t,e,i){var n=i[0]-e[0],r=i[1]-e[1],o=((t[0]-e[0])*n+(t[1]-e[1])*r)/(n*n+r*r);return o<0?0:1<o?1:o}(t,e,i),r=i[0]-e[0],o=i[1]-e[1];return[e[0]+n*r,e[1]+n*o]},pointOnSegment:function(t,e,i,n){var r=i/n;return[o(t[0],e[0],r),o(t[1],e[1],r)]},distance:function(t,e){return Math.sqrt(a(t,e))}}},{}],5:[function(t,i,e){(function(t){var e="undefined"!=typeof window?window.L:void 0!==t?t.L:null;i.exports=e.CircleMarker.extend({show:function(){return this._container.style.visibility="",this},hide:function(){return this._container.style.visibility="hidden",this}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(h,l,t){(function(i){var a="undefined"!=typeof window?window.L:void 0!==i?i.L:null,m=h("./geometry"),n=h("./marker"),r=h("./endpoint"),o=h("./selection"),s=i.Rbush||h("rbush"),e=a.Browser.touch?"touchstart mousedown":"mousedown",t=a.Control.extend({statics:{Selection:o,Endpoint:r,ControlMarker:n},options:{startMarkerClass:"select-marker select-start-marker",endMarkerClass:"select-marker select-end-marker",movingMarkerClass:"select-marker select-moving-marker",name:"leaflet-linestring-select",lineWeight:4,lineTolerance:a.Browser.mobile?10:5,movingMarkerStyle:{fillColor:"#fff",fillOpacity:1,weight:2,opacity:.5,color:"#000"},endpointStyle:{radius:5,color:"#111",fillColor:"#fff",fillOpacity:1},selectionStyle:{color:"#0ff",opacity:1},useTouch:a.Browser.mobile,position:"topright"},initialize:function(t){t=t||{},this._startMarker=null,this._endMarker=null,this._movingMarker=null,this._feature=null,this._layer=null,this._selection=null,this._tolerance=null,a.Util.setOptions(this,t),a.Control.prototype.initialize.call(this,this.options)},onAdd:function(t){var e=this._container=a.DomUtil.create("div",this.options.containerClass);return a.DomEvent.disableClickPropagation(e).disableScrollPropagation(e),e},onRemove:function(t){this.disable()},enable:function(t){return this._layer=t.layer,this._feature=t.feature||t.layer.toGeoJSON(),this._createHandles(),this._buildTree(),this._layer.on("click",this._onLayerClick,this),this._map.on("moveend zoomend resize",this._calculatePointerTolerance,this).on("mousemove touchmove",this._onMousemove,this).on(e,this._onMouseDown,this).on("click contextmenu",this._onMapClick,this),this._calculatePointerTolerance(),this},disable:function(){return this.reset(),this._map.removeLayer(this._movingMarker),this._movingMarker=null,this._layer.off("click",this._onLayerClick,this),this._map.off("moveend zoomend resize",this._calculatePointerTolerance,this).off("mousemove touchmove",this._onMousemove,this).off(e,this._onMouseDown,this).off("click contextmenu",this._onMapClick,this),this._feature=null,this._layer=null,this},reset:function(){return this._startMarker&&(this._map.removeLayer(this._startMarker),this._startMarker=null),this._endMarker&&(this._map.removeLayer(this._endMarker),this._endMarker=null),this._selection&&(this._map.removeLayer(this._selection),this._selection=null),this._movingMarker.setLatLng(this._layer.getLatLngs()[0]),this.options.useTouch||this._map.addLayer(this._movingMarker),this.fire("reset"),this},getSelection:function(){return this._selection?this._selection.getLatLngs():null},toGeoJSON:function(){return this._selection?this._selection.toGeoJSON():null},selectMeters:function(t,e){if(this.reset(),t<0||e<0)throw new Error("Can't use negative meter values for distance selection");var i=this._pointAtM(t),n=this._pointAtM(e);return i=this._getNearestPoint(i),n=this._getNearestPoint(n),this._setPoint(i,i.start,i.end),this._setPoint(n,n.start,n.end),this},movingMarkerFactory:function(t,e){return new n(t,e)},endpointFactory:function(t,e,i){return new r(t,e)},selectionFactory:function(t,e,i){return new o(t,e,i)},_distance:function(t,e){return this.options.distance?this.options.distance(t,e):new a.LatLng(t[1],t[0]).distanceTo(new a.LatLng(e[1],e[0]))},_getProjectedPoint:function(t){return this.options.getProjectedPoint?this.options.getProjectedPoint.call(this,t):[(t=this._map.options.crs.latLngToPoint(new a.LatLng(t[1],t[0]),this._map.getMaxZoom())).x,t.y]},_pointAtSegmentM:function(t,e,i){var n=this._distance(t,e);t=this._getProjectedPoint(t),e=this._getProjectedPoint(e);var r=m.pointOnSegment(t,e,i,n);return a.point(r)},_pointAtM:function(t){var e,i,n,r=this._feature.geometry.coordinates,o=0;for(i=1,n=r.length;i<n;i++){var s=this._distance(r[i-1],r[i]);if(!(o+s<=t))break;o+=s}return o===t||i===r.length?(e=r[i-1],new a.LatLng(e[1],e[0])):(e=this._pointAtSegmentM(r[i-1],r[i],t-o),this._map.options.crs.pointToLatLng(e,this._map.getMaxZoom()))},_calculatePointerTolerance:function(){var t=this._map.getCenter(),e=.5*this.options.lineWeight+this.options.lineTolerance,i=this._map.layerPointToLatLng(this._map.latLngToLayerPoint(t).add(new a.Point(e,e)));this._tolerance=new a.LatLng(Math.abs(t.lat-i.lat),Math.abs(t.lng-i.lng))},_createHandles:function(){var t=a.latLng(this._layer.getLatLngs()[0]),e=this.options.movingMarkerStyle;e.radius=this.options.lineTolerance,e.className=this.options.movingMarkerClass,this._movingMarker=this.movingMarkerFactory(t,e).addTo(this._map),this._movingMarker.on("click",this._onMovingMarkerClick,this),this.options.useTouch&&this._map.removeLayer(this._movingMarker)},_onMovingMarkerClick:function(t){a.DomEvent.stopPropagation(t),this._setPoint(this._movingMarker.getLatLng(),this._movingMarker.start,this._movingMarker.end)},_onLayerClick:function(t){var e=this._getNearestPoint(t.latlng);e?this._setPoint(a.latLng(e),e.start,e.end):this._setPoint(t.latlng)},_onMapClick:function(t){if(!this._endMarker){var e=this._map.latLngToLayerPoint(t.latlng),i=this._movingMarker.getLatLng();if(this.options.useTouch){var n=this._getNearestPoint(t.latlng);n&&(i=a.latLng(n),this._movingMarker.setLatLng(i))}var r=this._map.latLngToLayerPoint(i);m.distance([e.x,e.y],[r.x,r.y])<=2*this.options.lineTolerance&&(i=this._getNearestPoint(i),this._setPoint(i,i.start,i.end))}},_setPoint:function(t,e,i){var n=this.options.endpointStyle;this._startMarker?this._endMarker||(n.className=this.options.endMarkerClass,this._endMarker=this.endpointFactory(t,n,!0).addTo(this._map),this._endMarker.start=e,this._endMarker.end=i,this._map.removeLayer(this._movingMarker),this.fire("select:end",{latlng:t}),this._startMarker&&this._endMarker&&this._onSelect()):(n.className=this.options.startMarkerClass,this._startMarker=this.endpointFactory(t,n,!1).addTo(this._map),this._startMarker.start=e,this._startMarker.end=i,this.fire("select:start",{latlng:t}))},_getPointerBounds:function(t){var e=this._tolerance.lng,i=this._tolerance.lat;return{minY:t.lat-i,minX:t.lng-e,maxY:t.lat+i,maxX:t.lng+e}},_onMouseDown:function(t){var e,i=t.originalEvent.target||t.originalEvent.srcElement;this.options.useTouch&&(this._startMarker&&(e=this._map.latLngToContainerPoint(this._startMarker.getLatLng()),m.distance([t.containerPoint.x,t.containerPoint.y],[e.x,e.y])<=2*this.options.lineTolerance&&(i=this._startMarker._path)),this._endMarker&&(e=this._map.latLngToContainerPoint(this._endMarker.getLatLng()),m.distance([t.containerPoint.x,t.containerPoint.y],[e.x,e.y])<=2*this.options.lineTolerance&&(i=this._endMarker._path)));this._startMarker&&this._startMarker._path===i?(this._dragging=this._startMarker,this._static=this._endMarker):this._endMarker&&this._endMarker._path===i&&(this._dragging=this._endMarker,this._static=this._startMarker),this._dragging&&(a.DomEvent.stop(t),this._dragging._dragging=!0,a.Draggable._disabled=!0,this._map.dragging.disable(),this._map.once("mouseup",this._stopHandlerDrag,this))},_stopHandlerDrag:function(t){this._dragging&&(i.clearTimeout(this._dragTimer),a.Draggable._disabled=!1,this._map.dragging.enable(),this._dragging._dragging=null,this._dragging=null,this._onDragStopped(this._dragging,t.latlng))},_onDragStopped:function(t,e){this._startMarker&&this._endMarker&&this._onSelect()},_checkEndPoints:function(){if(this._startMarker.start>this._endMarker.start){var t=this._startMarker;this._startMarker=this._endMarker,this._endMarker=t}},_onSelect:function(){this._checkEndPoints();var t=this._startMarker.end,e=this._endMarker.start,i=this._layer._latlngs.slice(t,e+1);i.unshift(this._startMarker.getLatLng()),i.push(this._endMarker.getLatLng()),this._selection?(this._selection._latlngs=i,this._selection.updatePathFromSource(this._startMarker.end,this._endMarker.start)):(this._selection=this.selectionFactory(i,this.options.selectionStyle,this._layer).addTo(this._map),this._startMarker.bringToFront(),this._endMarker.bringToFront()),this.fire("selection")},_onMousemove:function(t){var e=this._getNearestPoint(t.latlng);this._dragging?(e&&(this._dragging.start=e.start,this._dragging.end=e.end,this._dragging.setLatLng(e)),this._startMarker&&this._endMarker&&this._onSelect(),i.clearTimeout(this._dragTimer),this._dragTimer=i.setTimeout(this._stopHandlerDrag.bind(this,t),750)):e&&(this._movingMarker.setLatLng(e),this._movingMarker.start=e.start,this._movingMarker.end=e.end)},_getNearestPoint:function(t,e){var i=this._getPointerBounds(t,e),n=this._tree.search(i);if(0===n.length)return null;var r=this._feature.geometry.coordinates,o=Number.MAX_VALUE,s=[t.lng,t.lat],a=n[0].start,h=n[0].end,l=r[a],c=r[h];if(1<n.length)for(var u=0,d=n.length;u<d;u++){var f=n[u],_=r[f.start],p=r[f.end],g=m.pointSegmentDistance(s,_,p);g<o&&(o=g,l=_,c=p,a=f.start,h=f.end)}return(s=[(s=m.closestPointOnSegment(s,l,c))[1],s[0]]).start=a,s.end=h,s},_buildTree:function(){var t=this._feature.geometry.coordinates,e=[];this._tree?this._tree.clear():this._tree=new s(16);for(var i=1,n=t.length;i<n;i++){var r=this._toTreeNode(t[i-1],t[i]);r.start=i-1,r.end=i,e.push(r)}this._tree.load(e)},_toTreeNode:function(t,e){var i=t[0],n=e[0],r=t[1],o=e[1];return n<i&&(n=t[0],i=e[0]),o<r&&(o=t[1],r=e[1]),{minX:i,minY:r,maxX:n,maxY:o}}});a.Util.extend(t.prototype,a.Evented.prototype),l.exports=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./endpoint":3,"./geometry":4,"./marker":5,"./selection":7,rbush:2}],7:[function(t,i,e){(function(t){var n="undefined"!=typeof window?window.L:void 0!==t?t.L:null,e=n.Polyline.extend({initialize:function(t,e,i){this._source=i,n.Polyline.prototype.initialize.call(this,t,e)},updatePathFromSource:function(t,e){var i=this._source._rings[0].slice(t,e+1);i.unshift(this._map.latLngToLayerPoint(this._latlngs[0])),i.push(this._map.latLngToLayerPoint(this._latlngs[this._latlngs.length-1])),this._rings[0]=i,this._update()}});i.exports=e}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});
